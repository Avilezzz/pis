<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <title>Agregar Producto</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  </head>
  <body>
    <div class="container-fluid py-4">
      <!-- Header -->
      <div class="row mb-4">
        <div class="col">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h2 class="mb-1">
                <i class="bi bi-plus-circle text-primary me-2"></i>
                Crear Nuevo Producto
              </h2>
              <p class="text-muted mb-0">
                Añade un nuevo producto a tu inventario
              </p>
            </div>
            <div>
              <a href="/productos/listarproductos" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left me-2"></i>
                Volver a Productos
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Formulario -->
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-0 py-3">
              <h5 class="mb-0">
                <i class="bi bi-box-seam me-2"></i>
                Información del Producto
              </h5>
            </div>
            <div class="card-body p-4">
              <form
                th:action="@{/productos/guardar}"
                th:object="${producto}"
                method="post"
                class="needs-validation"
                novalidate
              >
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="nombre" class="form-label">
                      <i class="bi bi-tag me-1"></i>
                      Nombre del Producto
                    </label>
                    <input
                      type="text"
                      th:field="*{nombre}"
                      class="form-control"
                      placeholder="Ej: Hamburguesa Completa"
                      required
                    />
                    <div class="invalid-feedback">
                      Por favor ingresa el nombre del producto.
                    </div>
                  </div>

                  <div class="col-md-6 mb-3">
                    <label for="tipo" class="form-label">
                      <i class="bi bi-grid me-1"></i>
                      Tipo de Producto
                    </label>
                    <select th:field="*{tipo}" class="form-select" required>
                      <option value="">Selecciona el tipo</option>
                      <option value="comida">
                        <i class="bi bi-egg-fried"></i> Comida
                      </option>
                      <option value="bebida">
                        <i class="bi bi-cup-straw"></i> Bebida
                      </option>
                      <option value="frappes">
                        <i class="bi bi-cup-hot"></i> Frappés
                      </option>
                    </select>
                    <div class="invalid-feedback">
                      Por favor selecciona el tipo de producto.
                    </div>
                  </div>
                </div>

                <div class="mb-3">
                  <label for="descripcion" class="form-label">
                    <i class="bi bi-card-text me-1"></i>
                    Descripción
                  </label>
                  <textarea 
                    th:field="*{descripcion}" 
                    class="form-control" 
                    rows="3"
                    placeholder="Describe los ingredientes y características del producto..."
                  ></textarea>
                </div>

                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="precio" class="form-label">
                      <i class="bi bi-currency-dollar me-1"></i>
                      Precio
                    </label>
                    <div class="input-group">
                      <span class="input-group-text">$</span>
                      <input
                        type="number"
                        step="0.01"
                        th:field="*{precio}"
                        class="form-control"
                        placeholder="0.00"
                        min="0"
                        max="9999999"
                        required
                      />
                    </div>
                    <div class="invalid-feedback">
                      Por favor ingresa un precio válido.
                    </div>
                  </div>

                  <div class="col-md-6 mb-3">
                    <label for="imagenUrl" class="form-label">
                      <i class="bi bi-image me-1"></i>
                      URL de la Imagen
                    </label>
                    <input 
                      type="url" 
                      th:field="*{imagenUrl}" 
                      class="form-control"
                      placeholder="https://ejemplo.com/imagen.jpg"
                    />
                    <div class="form-text">
                      <i class="bi bi-info-circle me-1"></i>
                      Opcional: URL de la imagen del producto
                    </div>
                  </div>
                </div>

                <!-- Vista previa de la imagen -->
                <div class="mb-4" id="imagePreview" style="display: none;">
                  <label class="form-label">
                    <i class="bi bi-eye me-1"></i>
                    Vista Previa
                  </label>
                  <div class="text-center">
                    <img 
                      id="previewImg" 
                      src="" 
                      alt="Vista previa" 
                      class="img-thumbnail"
                      style="max-width: 200px; max-height: 200px; object-fit: cover;"
                    />
                  </div>
                </div>

                <div class="d-flex gap-2 justify-content-end">
                  <a href="/productos/listarproductos" class="btn btn-outline-secondary">
                    <i class="bi bi-x-circle me-2"></i>
                    Cancelar
                  </a>
                  <button type="submit" class="btn btn-primary">
                    <i class="bi bi-check-circle me-2"></i>
                    Guardar Producto
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Validación del formulario
      (function() {
        'use strict';
        window.addEventListener('load', function() {
          var forms = document.getElementsByClassName('needs-validation');
          var validation = Array.prototype.filter.call(forms, function(form) {
            form.addEventListener('submit', function(event) {
              if (form.checkValidity() === false) {
                event.preventDefault();
                event.stopPropagation();
              }
              form.classList.add('was-validated');
            }, false);
          });
        }, false);
      })();

      // Vista previa de imagen
      document.addEventListener('DOMContentLoaded', function() {
        const imageUrlInput = document.querySelector('input[th\\:field="*{imagenUrl}"]');
        const imagePreview = document.getElementById('imagePreview');
        const previewImg = document.getElementById('previewImg');

        if (imageUrlInput) {
          imageUrlInput.addEventListener('input', function() {
            const url = this.value.trim();
            if (url && isValidUrl(url)) {
              previewImg.src = url;
              imagePreview.style.display = 'block';
              
              // Manejar errores de carga de imagen
              previewImg.onerror = function() {
                imagePreview.style.display = 'none';
              };
              
              previewImg.onload = function() {
                imagePreview.style.display = 'block';
              };
            } else {
              imagePreview.style.display = 'none';
            }
          });
        }

        function isValidUrl(string) {
          try {
            new URL(string);
            return true;
          } catch (_) {
            return false;
          }
        }
      });
    </script>
  </body>
</html>
