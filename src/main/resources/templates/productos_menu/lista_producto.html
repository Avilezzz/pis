<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <title>Lista de Productos</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/css/dashboard.css" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- Contenedor principal del dashboard -->
    <div class="dashboard-container">
      <!-- Sidebar -->
      <div class="sidebar">
        <!-- Logo/Brand -->
        <div class="logo-container">
          <img
            th:src="@{/img/logoPapaDReveloPis.png}"
            alt="Logo"
            width="150"
            class="me-2"
          />
        </div>

        <!-- Navigation Buttons -->
        <div class="nav-buttons">
          <a href="/admin/pedido" class="nav-button" data-action="ver-pedidos">
            <i class="fas fa-clipboard-list me-2"></i> Ver Pedidos
          </a>
          <a
            href="/productos/lista"
            class="nav-button active"
            data-action="lista-productos"
          >
            <i class="fas fa-boxes me-2"></i> Productos
          </a>
        </div>
      </div>

      <!-- Contenido principal -->
      <main class="main-content">
        <div class="container-fluid py-4">
          <!-- Encabezado y controles -->
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h2><i class="fas fa-list"></i> Lista de Productos</h2>
            <div class="d-flex gap-2">
              <!-- Filtro por tipo -->
              <div class="dropdown">
                <button
                  class="btn btn-outline-secondary dropdown-toggle"
                  type="button"
                  id="filtroTipo"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  <i class="fas fa-filter"></i>
                  <span
                    th:text="${tipoFiltro != null ? tipoFiltro : 'Todos los tipos'}"
                    >Todos los tipos</span
                  >
                </button>
                <ul class="dropdown-menu" aria-labelledby="filtroTipo">
                  <li>
                    <a class="dropdown-item" href="/productos/lista"
                      >Todos los tipos</a
                    >
                  </li>
                  <li>
                    <a class="dropdown-item" href="/productos/lista?tipo=comida"
                      >Comida</a
                    >
                  </li>
                  <li>
                    <a class="dropdown-item" href="/productos/lista?tipo=bebida"
                      >Bebida</a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="/productos/lista?tipo=frappes"
                      >Frappés</a
                    >
                  </li>
                </ul>
              </div>
              <button
                class="btn btn-success"
                data-bs-toggle="modal"
                data-bs-target="#nuevoProductoModal"
              >
                <i class="fas fa-plus"></i> Nuevo Producto
              </button>
            </div>
          </div>

          <!-- Información de productos -->
          <div class="row mb-3">
            <div class="col-md-6">
              <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                <strong th:text="${#lists.size(productos)}">0</strong>
                producto(s) encontrado(s)
                <span
                  th:if="${tipoFiltro != null}"
                  th:text="' - Filtrado por: ' + ${tipoFiltro}"
                ></span>
              </div>
            </div>
          </div>

          <!-- Tabla de Productos -->
          <div class="card">
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-striped table-hover">
                  <thead class="table-dark">
                    <tr>
                      <th>ID</th>
                      <th>Imagen</th>
                      <th>Nombre</th>
                      <th>Descripción</th>
                      <th>Tipo</th>
                      <th>Precio</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr th:each="producto : ${productos}">
                      <td th:text="${producto.id}"></td>
                      <td>
                        <img
                          th:if="${producto.imagenUrl != null and producto.imagenUrl != ''}"
                          th:src="${producto.imagenUrl}"
                          class="img-thumbnail"
                          style="width: 50px; height: 50px; object-fit: cover"
                          alt="Imagen del producto"
                        />
                        <div
                          th:unless="${producto.imagenUrl != null and producto.imagenUrl != ''}"
                          class="bg-secondary text-white d-flex align-items-center justify-content-center"
                          style="width: 50px; height: 50px"
                        >
                          <i class="fas fa-image"></i>
                        </div>
                      </td>
                      <td th:text="${producto.nombre}"></td>
                      <td th:text="${producto.descripcion}"></td>
                      <td>
                        <span
                          th:class="${'badge ' + (producto.tipo == 'comida' ? 'bg-primary' : (producto.tipo == 'bebida' ? 'bg-success' : 'bg-warning'))}"
                          th:text="${producto.tipo}"
                        ></span>
                      </td>
                      <td
                        th:text="${'$' + #numbers.formatDecimal(producto.precio, 1, 2)}"
                      ></td>
                      <td>
                        <button
                          class="btn btn-sm btn-primary me-1 btn-editar"
                          th:data-id="${producto.id}"
                          th:data-nombre="${producto.nombre}"
                          th:data-descripcion="${producto.descripcion}"
                          th:data-tipo="${producto.tipo}"
                          th:data-precio="${producto.precio}"
                          th:data-imagen="${producto.imagenUrl}"
                        >
                          <i class="fas fa-edit"></i>
                        </button>
                        <button
                          class="btn btn-sm btn-danger btn-eliminar"
                          th:data-id="${producto.id}"
                          th:data-nombre="${producto.nombre}"
                        >
                          <i class="fas fa-trash"></i>
                        </button>
                      </td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(productos)}">
                      <td colspan="7" class="text-center text-muted">
                        <i class="fas fa-inbox fa-2x mb-2"></i>
                        <br />No hay productos registrados
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Modal para Editar Producto -->
    <div
      class="modal fade"
      id="editarProductoModal"
      tabindex="-1"
      aria-labelledby="editarProductoModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="editarProductoModalLabel">
              <i class="fas fa-edit"></i> Editar Producto
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <form th:action="@{/productos/actualizar}" method="post">
            <div class="modal-body">
              <input type="hidden" id="editId" name="id" />

              <div class="mb-3">
                <label for="editNombre" class="form-label">Nombre</label>
                <input
                  type="text"
                  id="editNombre"
                  name="nombre"
                  class="form-control"
                  required
                />
              </div>

              <div class="mb-3">
                <label for="editDescripcion" class="form-label"
                  >Descripción</label
                >
                <input
                  type="text"
                  id="editDescripcion"
                  name="descripcion"
                  class="form-control"
                />
              </div>

              <div class="mb-3">
                <label for="editTipo" class="form-label"
                  >Tipo de Producto</label
                >
                <select id="editTipo" name="tipo" class="form-select" required>
                  <option value="">Selecciona el tipo</option>
                  <option value="comida">Comida</option>
                  <option value="bebida">Bebida</option>
                  <option value="frappes">Frappés</option>
                </select>
              </div>

              <div class="mb-3">
                <label for="editPrecio" class="form-label">Precio</label>
                <input
                  type="number"
                  id="editPrecio"
                  name="precio"
                  step="0.01"
                  class="form-control"
                  min="0"
                  max="9999999"
                  required
                />
              </div>

              <div class="mb-3">
                <label for="editImagenUrl" class="form-label">URL Imagen</label>
                <input
                  type="text"
                  id="editImagenUrl"
                  name="imagenUrl"
                  class="form-control"
                />
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                <i class="fas fa-times"></i> Cancelar
              </button>
              <button type="submit" class="btn btn-warning">
                <i class="fas fa-save"></i> Actualizar Cambios
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Modal de Confirmación para Eliminar -->
    <div
      class="modal fade"
      id="eliminarProductoModal"
      tabindex="-1"
      aria-labelledby="eliminarProductoModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="eliminarProductoModalLabel">
              <i class="fas fa-exclamation-triangle text-warning"></i> Confirmar
              Eliminación
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <p>
              ¿Estás seguro de que deseas eliminar el producto
              <strong id="nombreProductoEliminar"></strong>?
            </p>
            <p class="text-muted">Esta acción no se puede deshacer.</p>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              <i class="fas fa-times"></i> Cancelar
            </button>
            <form
              th:action="@{/productos/eliminar}"
              method="post"
              style="display: inline"
            >
              <input type="hidden" id="idProductoEliminar" name="id" />
              <button type="submit" class="btn btn-danger">
                <i class="fas fa-trash"></i> Eliminar
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal para Nuevo Producto -->
    <div
      class="modal fade"
      id="nuevoProductoModal"
      tabindex="-1"
      aria-labelledby="nuevoProductoModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="nuevoProductoModalLabel">
              <i class="fas fa-plus"></i> Nuevo Producto
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <form th:action="@{/productos/guardar}" method="post">
            <div class="modal-body">
              <div class="mb-3">
                <label for="nombre" class="form-label">Nombre</label>
                <input
                  type="text"
                  id="nombre"
                  name="nombre"
                  class="form-control"
                  required
                />
              </div>

              <div class="mb-3">
                <label for="descripcion" class="form-label">Descripción</label>
                <input
                  type="text"
                  id="descripcion"
                  name="descripcion"
                  class="form-control"
                />
              </div>

              <div class="mb-3">
                <label for="tipo" class="form-label">Tipo de Producto</label>
                <select id="tipo" name="tipo" class="form-select" required>
                  <option value="">Selecciona el tipo</option>
                  <option value="comida">Comida</option>
                  <option value="bebida">Bebida</option>
                  <option value="frappes">Frappés</option>
                </select>
              </div>

              <div class="mb-3">
                <label for="precio" class="form-label">Precio</label>
                <input
                  type="number"
                  id="precio"
                  name="precio"
                  step="0.01"
                  class="form-control"
                  min="0"
                  max="9999999"
                  required
                />
              </div>

              <div class="mb-3">
                <label for="imagenUrl" class="form-label">URL Imagen</label>
                <input
                  type="text"
                  id="imagenUrl"
                  name="imagenUrl"
                  class="form-control"
                />
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                <i class="fas fa-times"></i> Cancelar
              </button>
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> Guardar
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- Scripts de Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Scripts personalizados -->
    <script src="/JS/lista_producto_crud_modales.js"></script>
  </body>
</html>
